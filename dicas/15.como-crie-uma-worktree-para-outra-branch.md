# Como crie uma worktree para outra branch

## Objetivo: Trabalhar em múltiplas branches sem mudar a pasta principal.

Para criar uma worktree para outra branch, você pode usar o comando 'git worktree add'. Isso permite ter vários diretórios de trabalho conectados ao mesmo repositório, cada um com uma branch diferente, sem precisar clonar o projeto várias vezes.

### Como funciona?

Cada worktree é uma cópia independente de uma branch do mesmo repositório, mas todas compartilham o mesmo histórico de commits e arquivos internos do Git. Isso significa que você não duplica todo o repositório, economizando espaço em disco.

![Imagem exemplo simple e visual worktree](../img/git-worktree-1.png)

1. Fluxo de Trabalho Tradicional (Sem git worktree)

Estrutura do Diretório:

/projeto-sem-worktree  
├── .git/               \<- Repositório Git principal  
├── index.html  
├── src/  
│   ├── app.js  
│   └── styles.css  
├── .gitignore  
└── README.md

2. Fluxo de Trabalho com git worktree

Estrutura do Diretório:

/caminho/do/seu/projeto/  
├── projeto-com-worktree/       \<- \*\*Worktree Principal\*\* (ex: no branch: feature/novo-recurso)  
│   ├── .git/                   \<- Repositório Git real (compartilhado)  
│   ├── index.html  
│   └── src/  
│       ├── app.js              \<- Com alterações em andamento (não commitadas)  
│       └── ...  
└── hotfix-critico/             \<- \*\*Worktree Vinculado\*\* (no branch: hotfix/bug-critico)  
    ├── .git                    \<- É um arquivo que aponta para o .git principal  
    ├── index.html  
    └── src/  
        ├── app.js              \<- Com a correção aplicada e commitada  
        └── ...

![Imagem exemplo simple e visual worktree](../img/git-worktree-2.png)

OBS: Mais detalhado em '15.exemplo-completo.md'

#### Exemplo rápido

Imagine que você está trabalhando na sua branch principal (main) e 'precisa iniciar uma correção de bug rápida'.

1. Crie um novo worktree:
    'git worktree add ../hotfix main'
    * Este comando cria um novo diretório chamado ../hotfix e faz o checkout da branch main lá.

2. Trabalhe na correção:
    'cd ../hotfix'
    * Agora você está no novo diretório e pode fazer suas alterações na branch main.

3. Volte ao trabalho original:
    'cd -'
    * Você retorna ao seu diretório principal, onde suas alterações na funcionalidade original permanecem intactas. 

### Passo a passo para criar uma worktree

- Suponha que você já esteja no diretório principal(main ou master ou etc...) do seu projeto e queira trabalhar em uma branch chamada feature-x.

1. Crie a worktree

- Execute o comando git worktree add para criar um novo diretório com o nome da sua branch e fazer o checkout dela automaticamente.

```sh
git worktree add ../feature-x feature-x
```

 * ../feature-x: É o caminho do novo diretório que será criado. O comando cria um diretório na mesma hierarquia do seu projeto principal.
 * feature-x: É o nome da branch que será usada na nova worktree.

2. Verifique as worktrees

- Para listar todas as worktrees vinculadas ao seu repositório, execute:

```sh
git worktree list
```

- A saída mostrará o diretório, o hash do commit e a branch de cada worktree.

3. Trabalhe na nova worktree

- Navegue até o novo diretório que foi criado (cd ../feature-x) e trabalhe como se estivesse em um clone separado. As alterações feitas aqui não afetarão o estado do seu diretório principal.

### Gerenciando worktrees

![Imagem exemplo simple e visual worktree](../img/git-worktree-3.png)

 * Criar uma nova branch na worktree: Se a branch ainda não existir, você pode criá-la e usar a worktree com um único comando:

```sh
git worktree add -b <nome_da_nova_branch> <caminho>
```

 * Remover uma worktree: Quando terminar o trabalho na branch e quiser remover o diretório da worktree, use o comando git worktree remove:

```sh
git worktree remove <caminho>
```

### Vantagens de usar worktrees

 * Multitarefa sem interrupção: Resolva um bug em uma branch enquanto o seu trabalho principal fica isolado, sem a necessidade de git stash ou git checkout.
 * Melhor desempenho: Uma worktree é mais eficiente do que clonar o repositório, pois compartilha a maior parte dos arquivos com o repositório principal, economizando espaço em disco.
 * Histórico e staging separados: Cada worktree tem seu próprio índice e diretório de trabalho, garantindo que as mudanças em uma não interfiram nas outras. 

#### Por que usar git worktree(Reforço)?

Essa funcionalidade é útil para quando você precisa trabalhar em várias tarefas ao mesmo tempo sem atrapalhar seu diretório principal. Por exemplo: 

 * Corrigir um bug urgente: Você está no meio do desenvolvimento de uma nova funcionalidade, mas precisa parar para corrigir um problema crítico. Com git worktree, você não precisa fazer stash (salvar temporariamente) suas mudanças. Basta criar um novo worktree, ir para a branch de correção e trabalhar nela.
 * Revisar código: Você pode criar um worktree temporário para testar o código de um colega sem afetar o seu trabalho atual. Quando terminar, basta remover o worktree.
 * Comparar versões: Facilita a comparação de diferentes versões ou branches lado a lado.

### Fluxograma de exemplo:

```mermaid
graph  TD

%% Fluxo Principal (Worktree)

subgraph  Worktree["Criacao  e  Trabalho  no  Worktree"]

A[Inicio: Trabalhando  em  feature/X] --> W1

W1(git worktree add ../hotfix -b hotfix/bug-ABC main)  --> W2

W2(cd ../hotfix)  --> W3{Aplicar  correcao  de  bug}

W3  --> W4(git add .)

W4  --> W5(git commit -m 'Hotfix: Correcao do Bug ABC')

W5  --> W6(git push origin hotfix/bug-ABC)

end

  

%% Fluxo de Integracao (Main)

subgraph  Main["Integracao  e  Finalizacao"]

W6  --> I1{Revisao  de  Codigo  PR  Aprovada}

I1  --  Sim  --> I2(Voltar ao Diretorio Principal: cd ../seu-projeto)

I2  --> I3(git switch main)

I3  --> I4(Absorver correcao: git merge hotfix/bug-ABC)

I4  --> I5(git push origin main)

I5  --> I6(git worktree remove ../hotfix)

I6  --> I7(Limpar o branch: git branch -d hotfix/bug-ABC)

I7  --> F[Fim: Bug  corrigido  e  worktree  finalizado]

  

%% Reverte ao push para mais trabalho ou revisao

I1  --  Nao  --> W6

end

  

%% Fluxo de Retorno ao Feature

subgraph  Retorno["Continuar  o  Desenvolvimento"]

I7  --> R1(git switch feature/X)

R1  --> R2[Continuar  o  trabalho  em  feature/X]

end
```

