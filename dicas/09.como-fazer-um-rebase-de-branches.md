# Como fazer um Rebase de branches

Para manter um histórico Git limpo e linear, você pode usar o comando `git rebase` para transferir os commits de uma branch para outra. A operação reescreve o histórico do seu branch de trabalho, colocando os commits em cima do commit mais recente do branch de destino (como `master` ou `main`).

**Atenção**: Nunca faça um rebase em um branch compartilhado com outros desenvolvedores, pois isso reescreve o histórico e pode causar problemas para a equipe. O rebase é geralmente usado em branches de recursos locais antes de serem integrados ao branch principal.

---

## Passo a passo para fazer um rebase

Suponha que você tenha um branch de recurso chamado `feature-1` e queira rebaseá-lo sobre o branch `master` ou `main`.

### 1. Atualize o branch principal

Mude para o branch principal e garanta que ele esteja atualizado com o repositório remoto.

```sh
git checkout master   # ou git checkout main
git pull origin master  # ou git pull origin main
````

### 2. Mude para o branch de recurso

Volte para o branch que você deseja rebasear.

```sh
git checkout feature-1
```

### 3. Inicie o rebase

Execute o comando `git rebase` para mover os commits de `feature-1` para o topo do histórico de `master`.

```sh
git rebase master
```

O Git aplicará cada commit da sua branch sobre a `master`, resultando em uma linha reta no histórico.

### 4. Resolva conflitos (se houver)

Se houver conflitos, o rebase será pausado. Para resolver:

1. Edite os arquivos para resolver as marcações de conflito (`<<<<<<<`, `=======`, `>>>>>>>`).
2. Adicione os arquivos resolvidos ao staging area:

```sh
git add .
```

3. Continue o rebase:

```sh
git rebase --continue
```

4. Repita o processo até que todos os conflitos sejam resolvidos.
5. Para abortar o rebase a qualquer momento:

```sh
git rebase --abort
```

### 5. Envie as mudanças para o remoto

Após um rebase bem-sucedido, o histórico local será diferente do remoto. Por isso, um `git push` normal pode falhar. Para enviar com segurança:

```sh
git push origin feature-1 --force-with-lease
```

---

## Diferença entre rebase e merge

| Comando      | O que faz                                                                          | Histórico                                                                                               |
| :----------- | :--------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------ |
| `git merge`  | Integra mudanças de um branch para outro, criando um commit de merge               | Histórico não-linear, linhas de desenvolvimento visíveis                                                |
| `git rebase` | Transfere commits para o topo de outro branch, criando um histórico limpo e linear | Histórico linear, mais organizado, mas reescreve commits e pode ser perigoso em branches compartilhados |

---
---
---

## Git Interactive Rebase (`git rebase -i`)

## Objetivo
Reescrever e organizar o histórico de commits de uma branch local, tornando-o mais limpo e legível antes de integrar ao branch principal.

> ⚠️ **Cuidado:** Nunca faça rebase interativo em branches compartilhadas ou publicadas, pois isso reescreve o histórico e pode causar problemas para outros colaboradores.

---

## 1. Iniciando o rebase interativo

- Escolha o ponto no histórico a partir do qual deseja editar commits. Normalmente usamos `HEAD~n`:

```sh
# Exemplo: reescrever os últimos 3 commits
git rebase -i HEAD~3
````

* Isso abrirá um editor com uma lista dos commits do mais antigo para o mais recente.

---

## 2. Entendendo o arquivo de rebase

* Estrutura típica:

```
pick 5938f9b Adiciona feature A
pick 12e5c7a Corrige typo na feature A
pick 8d09a2f Atualiza feature A

# Comandos:
# pick = manter o commit
# reword (r) = editar a mensagem do commit
# edit (e) = parar para modificar arquivos
# squash (s) = combinar este commit com o anterior
# fixup (f) = como squash, mas descarta a mensagem do commit
# exec (x) = executar comando shell
# drop (d) = remover commit
```

---

## 3. Ações comuns

### 3.1 Squash (combinar commits)

* Combina commits menores em um único commit.

```text
pick 5938f9b Adiciona feature A
s 12e5c7a Corrige typo na feature A
s 8d09a2f Atualiza feature A
```

* Após salvar, o Git abrirá um editor para que você escreva a mensagem do commit combinado.

### 3.2 Reword (editar mensagem)

* Permite alterar a mensagem de um commit:

```text
r 5938f9b Adiciona feature A
s 12e5c7a Corrige typo na feature A
s 8d09a2f Atualiza feature A
```

* Git abrirá o editor para cada commit marcado com `reword`.

---

## 4. Finalizando o rebase

1. Salve e feche o editor para que o Git inicie o rebase.
2. Resolva conflitos se aparecerem e use:

```sh
git rebase --continue
```

3. Repita até que todos os commits sejam aplicados e o rebase finalize.

---

## 5. Enviando para o repositório remoto

* Como o rebase reescreve o histórico, você precisa forçar o push (de forma segura):

```sh
git push origin sua-branch --force-with-lease
```

---

## 6. Quando usar `git rebase -i`?

* **Organizar commits locais:** Transformar vários commits pequenos em um commit único e significativo.
* **Limpar branches de feature:** Antes de enviar um pull request.
* **Evitar commits de merge:** Mantém o histórico linear.

---

## 7. Dicas importantes

* Sempre faça backup ou use uma branch temporária antes de rebasear.
* Use `git log --oneline --graph` para visualizar o histórico antes e depois do rebase.
* Combine squash e reword para criar um histórico limpo e descritivo.

