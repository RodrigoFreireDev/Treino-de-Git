# Como use git reflog para recuperar commits 'perdidos'

## Objetivo: Entender o histórico oculto.

O git reflog é uma ferramenta de segurança que registra o histórico de todas as alterações feitas nas referências (HEAD, branches, etc.) do seu repositório local. Diferente do git log, que mostra o histórico da branch atual, o reflog rastreia cada vez que o HEAD mudou, mesmo após operações destrutivas como reset, rebase ou exclusão de branches.

O reflog funciona como uma "rede de segurança" que permite recuperar commits ou branches que pareciam perdidos após uma manipulação do histórico.

### Como usar git reflog para recuperar commits

1. Visualize o reflog

- Execute o comando git reflog para ver a lista cronológica de todas as ações que modificaram o HEAD.

```sh
git reflog
```

- A saída mostrará uma lista de eventos, cada um com um hash de commit e uma descrição da ação (por exemplo, commit, checkout, rebase, reset).

Exemplo de saída:
```
a1b2c3d HEAD@{0}: commit: Adiciona nova funcionalidade
e4f5g6h HEAD@{1}: reset: movendo de b8e6a10 para e4f5g6h
i7j8k9l HEAD@{2}: checkout: movendo de feature-x para master
```

2. Identifique o commit a ser recuperado

- Procure na lista o hash do commit que você quer restaurar. O reflog inclui a ação que o levou a "perder" o commit. Por exemplo, se você fez um git reset --hard por engano, procure a entrada anterior a essa ação.

- Encontre o hash do commit que você deseja restaurar. Você pode identificar o commit pelo seu hash abreviado (por exemplo, e4f5g6h) ou pela sua posição relativa no reflog (por exemplo, HEAD@{1}).

3. Recupere o commit

3.1. Opção 1: Crie uma nova branch para recuperação

Para trabalhar com segurança, crie uma nova branch a partir do hash que você identificou. Isso restaura o estado do seu repositório naquele ponto sem afetar sua branch atual.

Se você quiser recuperar um estado de commit e criar um novo branch a partir dele, use o comando git checkout -b.

```sh
git checkout -b <nome_do_novo_branch exemplo> [hash-do-commit]
```

```sh
git checkout -b <nome_do_novo_branch exemplo: recovery-branch> e4f5g6h
```

3.2. Opção 2: Restaurar o commit perdido (git reset --hard)

- (git reset --hard): Use o git reset --hard para voltar ao estado do commit específico, descartando todas as alterações locais subsequentes.

```sh
git reset --hard e4f5g6h
```

3.3. Opção 3: Opção 3: Mesclar o commit:

- Se você estiver em outro branch e quiser mesclar o commit perdido, pode usar git merge.

```sh
git checkout master
git merge e4f5g6h
```

4. Verifique e restaure os commits (opcional)

Na sua nova branch (recovery-branch), você pode verificar se os commits perdidos estão presentes com git log. Se estiverem, você pode reincorporá-los à sua branch original de várias maneiras:

- Merge: Volte para a branch principal (git checkout main) e faça um merge da recovery-branch.

```sh
git merge recovery-branch
```

- Cherry-pick: Se você precisar apenas de um ou mais commits específicos, use git cherry-pick.

```sh
git cherry-pick [hash-do-commit-especifico]
```

5. Retorne ao estado original

- Após a recuperação, use git reflog reset para voltar ao seu estado de trabalho original.

### Limitações do reflog

 * Local: O reflog existe apenas em seu repositório local. Ele não é enviado para o repositório remoto.
 * Tempo de vida: As entradas do reflog expiram após um determinado período (normalmente 90 dias) e são apagadas para economizar espaço em disco.

### Exemplo prático de recuperação

- Suponha que você tenha feito um git reset --hard por engano, apagando os últimos commits da sua branch.

1. Exiba o reflog para encontrar o commit:
```sh
git reflog
```

- A saída mostra que a última ação foi um reset, e o commit anterior foi a1b2c3d.

```
b8e6a10 HEAD@{0}: reset: movendo de HEAD~2
a1b2c3d HEAD@{1}: commit: Trabalho importante, não apagar!
```

2. Recupere o commit perdido:

- Para recuperar o commit a1b2c3d, você pode usar um reset --hard para voltar a esse ponto.

```sh
git reset --hard a1b2c3d
```

3. Verifique o histórico:

- Agora, o git log mostrará que sua branch foi restaurada para o estado do commit a1b2c3d. O commit que você erroneamente apagou foi restaurado.

